<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>G-Edit - Editor de Video Avanzado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.17/interact.min.js"></script>
  <style id="app-style">
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      overflow: hidden;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1f2937;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }

    .timeline-container {
      position: relative;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .timeline-track {
      position: relative;
      height: 60px;
      margin-bottom: 10px;
      background: #1f2937;
      border-radius: 4px;
    }

    .timeline-track.audio {
      background: #333333;
    }

    .timeline-track.subtitle {
      background: #065f46;
      height: 40px;
    }

    .timeline-clip {
      position: absolute;
      height: 100%;
      border-radius: 4px;
      padding: 5px;
      color: white;
      cursor: grab;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      overflow: hidden;
      display: flex;
      align-items: center;
    }

    .timeline-clip.video {
      background: linear-gradient(to right, #333333, #666666);
    }

    .timeline-clip.audio {
      background: linear-gradient(to right, #222222, #444444);
    }
    
    .timeline-clip.subtitle {
      background: linear-gradient(to right, #047857, #10b981);
    }

    .timeline-clip img {
      height: 80%;
      margin-right: 8px;
      border-radius: 2px;
    }

    .timeline-clip .clip-label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .clip-handle {
      position: absolute;
      width: 8px;
      height: 100%;
      top: 0;
      background: rgba(255,255,255,0.3);
      cursor: col-resize;
    }

    .clip-handle.left {
      left: 0;
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;
    }

    .clip-handle.right {
      right: 0;
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;
    }

    .timeline-ruler {
      height: 25px;
      position: relative;
      background: #111827;
      margin-bottom: 10px;
    }

    .timeline-marker {
      position: absolute;
      top: 0;
      width: 1px;
      height: 10px;
      background: #6b7280;
    }

    .timeline-marker.major {
      height: 20px;
      background: #9ca3af;
    }

    .timeline-marker-label {
      position: absolute;
      top: 22px;
      transform: translateX(-50%);
      font-size: 10px;
      color: #9ca3af;
    }

    .timeline-playhead {
      position: absolute;
      top: 0;
      width: 2px;
      height: calc(100% - 25px);
      background: #ef4444;
      z-index: 10;
    }

    .timeline-playhead::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid #ef4444;
    }

    .media-item {
      cursor: grab;
      transition: all 0.2s;
    }

    .media-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .preview-player {
      position: relative;
      background: #000;
      aspect-ratio: 16/9;
      overflow: hidden;
    }

    .player-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      padding: 10px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .preview-player:hover .player-controls {
      opacity: 1;
    }

    .properties-panel {
      overflow-y: auto;
    }

    .processing-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .transition-preview {
      width: 100%;
      height: 80px;
      background: #111827;
      border-radius: 4px;
      margin-bottom: 10px;
      overflow: hidden;
      position: relative;
    }

    .waveform {
      width: 100%;
      height: 40px;
      background-image: url('https://cdn.pixabay.com/photo/2017/06/05/15/52/audio-2374613_960_720.png');
      background-size: cover;
      opacity: 0.7;
    }

    .dragging {
      opacity: 0.7;
      z-index: 1000;
    }

    /* Responsive design adjustments */
    @media (max-width: 768px) {
      .main-layout {
        grid-template-columns: 1fr !important;
        grid-template-rows: auto auto auto !important;
      }

      .sidebar {
        height: 200px !important;
        overflow-y: auto !important;
      }

      .properties-sidebar {
        height: 250px !important;
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100">
  <!-- Processing Overlay (Hidden by default) -->
  <div class="processing-overlay hidden">
    <div class="text-center">
      <div class="loading-spinner mx-auto mb-4"></div>
      <h3 class="text-xl font-bold">Procesando Video</h3>
      <p class="text-gray-300">Por favor espera mientras aplicamos tus cambios...</p>
    </div>
  </div>

  <!-- Top Toolbar -->
  <header class="bg-gray-800 p-3 border-b border-gray-700 flex items-center justify-between">
    <div class="flex items-center">
      <h1 class="text-xl font-bold mr-6 text-gray-200">G-Edit</h1>
      <div class="flex space-x-2">
        <button id="import-local" class="bg-gray-600 hover:bg-gray-700 px-3 py-1.5 rounded text-sm flex items-center">
          <i class="fas fa-folder-open mr-2"></i> Importar
        </button>
        <button id="import-cloud" class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded text-sm flex items-center">
          <i class="fas fa-cloud-download-alt mr-2"></i> Nube
        </button>
        <div class="border-r border-gray-600 h-6 mx-2"></div>
        <button id="undo-btn" class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded text-sm">
          <i class="fas fa-undo"></i>
        </button>
        <button id="redo-btn" class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded text-sm">
          <i class="fas fa-redo"></i>
        </button>
      </div>
    </div>
    <div class="flex items-center space-x-2">
      <button id="project-settings" class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded text-sm flex items-center">
        <i class="fas fa-cog mr-2"></i> Configuración
      </button>
      <button id="export-btn" class="bg-gray-600 hover:bg-gray-700 px-4 py-1.5 rounded text-sm font-medium flex items-center">
        <i class="fas fa-file-export mr-2"></i> Exportar
      </button>
    </div>
  </header>

  <!-- Main Application Layout -->
  <div class="main-layout grid grid-cols-[250px_1fr_300px] h-[calc(100vh-53px)]">
    <!-- Left Sidebar - Media Library -->
    <div class="sidebar bg-gray-800 border-r border-gray-700 flex flex-col h-full">
      <div class="p-3 border-b border-gray-700">
        <h2 class="font-medium text-sm uppercase tracking-wider text-gray-400">Biblioteca de Medios</h2>
      </div>
      <div class="p-3 border-b border-gray-700 flex">
        <div class="relative flex-1">
          <input type="text" placeholder="Buscar medios..." class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-8">
          <i class="fas fa-search absolute left-2.5 top-2.5 text-gray-400"></i>
        </div>
      </div>
      <div class="p-3 border-b border-gray-700">
        <div class="flex text-sm mb-2">
          <button class="bg-gray-600 rounded px-3 py-1 flex-1">Todo</button>
          <button class="bg-gray-700 rounded px-3 py-1 flex-1 mx-1">Vídeo</button>
          <button class="bg-gray-700 rounded px-3 py-1 flex-1">Audio</button>
        </div>
      </div>
      
      <!-- Media Items -->
      <div class="overflow-y-auto flex-1 p-3 grid grid-cols-2 gap-3 content-start">
        <!-- Video clips -->
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="video" data-id="video1">
          <div class="bg-gray-800 h-20 flex items-center justify-center">
            <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" alt="Mountain landscape" class="w-full h-full object-cover">
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Vista Montaña</div>
            <div class="text-xs text-gray-400">00:30</div>
          </div>
        </div>
        
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="video" data-id="video2">
          <div class="bg-gray-800 h-20 flex items-center justify-center">
            <img src="https://cdn.pixabay.com/photo/2020/04/30/03/26/rufous-5111261_960_720.jpg" alt="Bird" class="w-full h-full object-cover">
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Pájaro en Vuelo</div>
            <div class="text-xs text-gray-400">00:15</div>
          </div>
        </div>
        
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="video" data-id="video3">
          <div class="bg-gray-800 h-20 flex items-center justify-center">
            <img src="https://cdn.pixabay.com/photo/2013/10/09/02/27/lake-192990_960_720.jpg" alt="Lake" class="w-full h-full object-cover">
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Amanecer en el Lago</div>
            <div class="text-xs text-gray-400">00:45</div>
          </div>
        </div>
        
        <!-- Audio clips -->
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="audio" data-id="audio1">
          <div class="bg-gray-800 h-20 flex items-center justify-center p-2">
            <div class="waveform w-full rounded"></div>
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Música de Fondo</div>
            <div class="text-xs text-gray-400">01:30</div>
          </div>
        </div>
        
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="audio" data-id="audio2">
          <div class="bg-gray-800 h-20 flex items-center justify-center p-2">
            <div class="waveform w-full rounded"></div>
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Efecto de Sonido</div>
            <div class="text-xs text-gray-400">00:05</div>
          </div>
        </div>
        
        <div class="media-item bg-gray-700 rounded overflow-hidden" draggable="true" data-type="audio" data-id="audio3">
          <div class="bg-gray-800 h-20 flex items-center justify-center p-2">
            <div class="waveform w-full rounded"></div>
          </div>
          <div class="p-2">
            <div class="text-xs font-medium truncate">Voz en Off</div>
            <div class="text-xs text-gray-400">00:55</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Editor Area -->
    <div class="flex flex-col h-full bg-gray-900 overflow-hidden">
      <!-- Preview Player -->
      <div class="preview-player mx-auto w-full max-w-3xl mt-4">
        <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" class="w-full h-full object-cover" alt="Preview">
        <div class="player-controls">
          <div class="flex items-center justify-between mb-2">
            <div>
              <button class="text-white mr-2 hover:text-gray-400"><i class="fas fa-step-backward"></i></button>
              <button class="text-white bg-gray-600 hover:bg-gray-700 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-play"></i></button>
              <button class="text-white ml-2 hover:text-gray-400"><i class="fas fa-step-forward"></i></button>
            </div>
            <div>
              <button class="text-white hover:text-gray-400"><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="flex items-center">
            <span class="text-xs text-white mr-2">00:05</span>
            <div class="relative flex-1 h-2 bg-gray-700 rounded overflow-hidden">
              <div class="absolute left-0 top-0 h-full bg-gray-500" style="width: 20%"></div>
            </div>
            <span class="text-xs text-white ml-2">01:30</span>
          </div>
        </div>
      </div>

      <!-- Timeline Editor -->
      <div class="flex-1 mt-4 p-4 flex flex-col overflow-hidden">
        <!-- Timeline Controls -->
        <div class="flex justify-between items-center mb-3">
          <div class="flex items-center">
            <button class="bg-gray-800 hover:bg-gray-700 rounded p-1.5 mr-2">
              <i class="fas fa-cut"></i>
            </button>
            <button class="bg-gray-800 hover:bg-gray-700 rounded p-1.5 mr-2">
              <i class="fas fa-magnet"></i>
            </button>
            <div class="border-r border-gray-700 h-6 mr-2"></div>
            <button id="add-track-btn" class="bg-gray-800 hover:bg-gray-700 rounded p-1.5 mr-2 text-xs flex items-center">
              <i class="fas fa-plus mr-1"></i> Añadir Pista
            </button>
            <!-- Add this new button -->
            <button id="generate-subtitles-btn" class="bg-gray-800 hover:bg-gray-700 rounded p-1.5 mr-2 text-xs flex items-center">
              <i class="fas fa-closed-captioning mr-1"></i> Generar Subtítulos
            </button>
          </div>
          <div class="flex items-center">
            <button id="zoom-out-btn" class="bg-gray-800 hover:bg-gray-700 rounded p-1.5 mr-1">
              <i class="fas fa-search-minus"></i>
            </button>
            <button id="zoom-in-btn" class="bg-gray-800 hover:bg-gray-700 rounded p-1.5">
              <i class="fas fa-search-plus"></i>
            </button>
          </div>
        </div>

        <!-- Timeline Ruler -->
        <div class="timeline-ruler" id="timeline-ruler">
          <!-- Time markers will be dynamically inserted here -->
        </div>

        <!-- Timeline Tracks Container -->
        <div class="timeline-container flex-1 relative" id="timeline-container">
          <!-- Playhead -->
          <div class="timeline-playhead" id="playhead" style="left: 100px;"></div>
          
          <!-- Timeline Tracks -->
          <div class="timeline-track video" id="video-track-1">
            <div class="timeline-clip video" style="left: 50px; width: 200px;">
              <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" alt="Mountain clip">
              <span class="clip-label">Vista Montaña</span>
              <div class="clip-handle left"></div>
              <div class="clip-handle right"></div>
            </div>
            <div class="timeline-clip video" style="left: 260px; width: 120px;">
              <img src="https://cdn.pixabay.com/photo/2020/04/30/03/26/rufous-5111261_960_720.jpg" alt="Bird clip">
              <span class="clip-label">Pájaro en Vuelo</span>
              <div class="clip-handle left"></div>
              <div class="clip-handle right"></div>
            </div>
          </div>
          
          <div class="timeline-track audio" id="audio-track-1">
            <div class="timeline-clip audio" style="left: 30px; width: 300px;">
              <span class="clip-label">Música de Fondo</span>
              <div class="clip-handle left"></div>
              <div class="clip-handle right"></div>
            </div>
          </div>
          
          <div class="timeline-track subtitle" id="subtitle-track-1">
            <div class="timeline-clip subtitle" style="left: 70px; width: 150px;">
              <span class="clip-label">Bienvenido a las montañas</span>
              <div class="clip-handle left"></div>
              <div class="clip-handle right"></div>
            </div>
            <div class="timeline-clip subtitle" style="left: 280px; width: 100px;">
              <span class="clip-label">Pájaro volando arriba</span>
              <div class="clip-handle left"></div>
              <div class="clip-handle right"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Sidebar - Properties Panel -->
    <div class="properties-sidebar bg-gray-800 border-l border-gray-700 flex flex-col h-full">
      <div class="p-3 border-b border-gray-700">
        <h2 class="font-medium text-sm uppercase tracking-wider text-gray-400">Propiedades</h2>
      </div>
      
      <!-- Tabs -->
      <div class="p-2 border-b border-gray-700">
        <div class="flex text-sm">
          <button class="bg-gray-600 rounded px-3 py-1.5 flex-1">Clip</button>
          <button class="bg-gray-700 rounded px-3 py-1.5 flex-1 mx-1">Transiciones</button>
          <button class="bg-gray-700 rounded px-3 py-1.5 flex-1">Audio</button>
        </div>
      </div>
      
      <!-- Properties Panel Content -->
      <div class="properties-panel p-3 flex-1 overflow-y-auto">
        <!-- Clip Properties -->
        <div class="mb-4">
          <h3 class="text-sm font-medium mb-2">Información del Clip</h3>
          <div class="bg-gray-700 p-3 rounded mb-3">
            <div class="flex items-center mb-2">
              <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" class="w-12 h-12 object-cover rounded mr-3" alt="Mountain thumbnail">
              <div>
                <div class="font-medium">Vista Montaña</div>
                <div class="text-xs text-gray-400">00:00:30</div>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-xs mt-2">
              <div>
                <div class="text-gray-400">Tiempo Inicial</div>
                <div>00:00:05</div>
              </div>
              <div>
                <div class="text-gray-400">Tiempo Final</div>
                <div>00:00:35</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Trim -->
        <div class="mb-4">
          <h3 class="text-sm font-medium mb-2">Recorte</h3>
          <div class="bg-gray-700 p-3 rounded mb-3">
            <div class="flex justify-between mb-2 text-xs">
              <span>Inicio: 00:00:05</span>
              <span>Fin: 00:00:35</span>
            </div>
            <div id="trim-slider" class="mb-3"></div>
            <div class="grid grid-cols-2 gap-2">
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-cut mr-1"></i> Dividir
              </button>
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-trash mr-1"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
        
        <!-- Speed -->
        <div class="mb-4">
          <h3 class="text-sm font-medium mb-2">Velocidad y Duración</h3>
          <div class="bg-gray-700 p-3 rounded mb-3">
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm">Velocidad</label>
              <div class="text-sm">1.0x</div>
            </div>
            <input type="range" min="0.25" max="4" step="0.25" value="1" class="w-full">
            <div class="mt-2 grid grid-cols-3 gap-2">
              <button class="bg-gray-600 hover:bg-gray-500 text-xs py-1 px-2 rounded">0.5x</button>
              <button class="bg-gray-600 hover:bg-gray-500 text-xs py-1 px-2 rounded">1x</button>
              <button class="bg-gray-600 hover:bg-gray-500 text-xs py-1 px-2 rounded">2x</button>
            </div>
          </div>
        </div>
        
        <!-- Transform -->
        <div class="mb-4">
          <h3 class="text-sm font-medium mb-2">Transformar</h3>
          <div class="bg-gray-700 p-3 rounded mb-3">
            <div class="grid grid-cols-2 gap-2 mb-2">
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-arrows-alt mr-1"></i> Posición
              </button>
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-crop mr-1"></i> Recortar
              </button>
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-redo mr-1"></i> Rotar
              </button>
              <button class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded">
                <i class="fas fa-arrows-alt-h mr-1"></i> Voltear
              </button>
            </div>
            <div class="grid grid-cols-2 gap-3 text-xs">
              <div>
                <label class="text-gray-400 block mb-1">Escala</label>
                <input type="text" value="100%" class="bg-gray-600 w-full p-1.5 rounded">
              </div>
              <div>
                <label class="text-gray-400 block mb-1">Rotación</label>
                <input type="text" value="0°" class="bg-gray-600 w-full p-1.5 rounded">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Filters -->
        <div class="mb-4">
          <h3 class="text-sm font-medium mb-2">Filtros y Efectos</h3>
          <div class="bg-gray-700 p-3 rounded mb-3">
            <div class="grid grid-cols-3 gap-2 mb-3">
              <div class="bg-gray-600 hover:bg-gray-500 rounded p-1 cursor-pointer">
                <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" class="w-full h-12 object-cover rounded" alt="Normal">
                <div class="text-center text-xs mt-1">Normal</div>
              </div>
              <div class="bg-gray-600 hover:bg-gray-500 rounded p-1 cursor-pointer">
                <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" class="w-full h-12 object-cover rounded sepia" alt="Sepia" style="filter: sepia(100%)">
                <div class="text-center text-xs mt-1">Sepia</div>
              </div>
              <div class="bg-gray-600 hover:bg-gray-500 rounded p-1 cursor-pointer">
                <img src="https://cdn.pixabay.com/photo/2023/06/15/10/03/mountains-8065079_960_720.jpg" class="w-full h-12 object-cover rounded" alt="B&N" style="filter: grayscale(100%)">
                <div class="text-center text-xs mt-1">B&N</div>
              </div>
            </div>
            <div class="mb-2">
              <label class="text-xs block mb-1">Brillo</label>
              <input type="range" min="0" max="200" value="100" class="w-full">
            </div>
            <div class="mb-2">
              <label class="text-xs block mb-1">Contraste</label>
              <input type="range" min="0" max="200" value="100" class="w-full">
            </div>
            <div>
              <label class="text-xs block mb-1">Saturación</label>
              <input type="range" min="0" max="200" value="100" class="w-full">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dialogs (Hidden by default) -->
  <div id="export-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">Exportar Proyecto</h3>
        <button class="text-gray-400 hover:text-white close-dialog">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Formato</label>
        <select class="bg-gray-700 w-full rounded p-2 border border-gray-600">
          <option>MP4 (H.264)</option>
          <option>WebM</option>
          <option>GIF</option>
          <option>MOV</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Resolución</label>
        <select class="bg-gray-700 w-full rounded p-2 border border-gray-600">
          <option>1080p (1920x1080)</option>
          <option>720p (1280x720)</option>
          <option>480p (854x480)</option>
          <option>360p (640x360)</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Calidad</label>
        <div class="flex items-center">
          <span class="text-xs mr-2">Baja</span>
          <input type="range" min="1" max="5" value="4" class="flex-1">
          <span class="text-xs ml-2">Alta</span>
        </div>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Compartir en</label>
        <div class="grid grid-cols-4 gap-2 mt-2">
          <button class="bg-gray-700 hover:bg-gray-600 p-2 rounded">
            <i class="fab fa-youtube text-gray-300 text-xl"></i>
          </button>
          <button class="bg-gray-700 hover:bg-gray-600 p-2 rounded">
            <i class="fab fa-facebook text-gray-300 text-xl"></i>
          </button>
          <button class="bg-gray-700 hover:bg-gray-600 p-2 rounded">
            <i class="fab fa-twitter text-gray-300 text-xl"></i>
          </button>
          <button class="bg-gray-700 hover:bg-gray-600 p-2 rounded">
            <i class="fab fa-instagram text-gray-300 text-xl"></i>
          </button>
        </div>
      </div>
      <div class="flex justify-end space-x-2">
        <button class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded close-dialog">Cancelar</button>
        <button class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Exportar</button>
      </div>
    </div>
  </div>

  <div id="import-cloud-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">Importar desde la Nube</h3>
        <button class="text-gray-400 hover:text-white close-dialog">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mb-4">
        <div class="flex mb-3">
          <button class="bg-blue-600 px-3 py-1 rounded text-sm flex-1">Drive</button>
          <button class="bg-gray-700 px-3 py-1 rounded text-sm flex-1 mx-1">Dropbox</button>
          <button class="bg-gray-700 px-3 py-1 rounded text-sm flex-1">OneDrive</button>
        </div>
        <div class="bg-gray-700 p-4 rounded-lg text-center">
          <i class="fas fa-cloud-download-alt text-3xl mb-2 text-gray-400"></i>
          <p class="mb-2">Inicia sesión para acceder a tus archivos en la nube</p>
          <button class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded w-full">Iniciar Sesión</button>
        </div>
      </div>
      <div class="flex justify-end space-x-2">
        <button class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded close-dialog">Cancelar</button>
      </div>
    </div>
  </div>

  <script id="app-script">
    $(document).ready(function() {
      // Initialize timeline ruler
      initTimelineRuler();
      
      // Initialize jQuery UI components
      $("#trim-slider").slider({
        range: true,
        min: 0,
        max: 100,
        values: [15, 85]
      });

      // Dialog handlers
      $("#export-btn").click(function() {
        $("#export-dialog").removeClass("hidden");
      });
      
      $("#import-cloud").click(function() {
        $("#import-cloud-dialog").removeClass("hidden");
      });
      
      $(".close-dialog").click(function() {
        $(this).closest(".fixed").addClass("hidden");
      });

      // Import local files
      $("#import-local").click(function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'video/*,audio/*,image/*';
        input.multiple = true;
        input.onchange = e => {
          // This would normally process the files, but this is just a prototype
          showProcessingOverlay();
          setTimeout(hideProcessingOverlay, 1500);
        };
        input.click();
      });

      // Zoom controls
      let zoomLevel = 100;
      $("#zoom-in-btn").click(function() {
        if (zoomLevel < 200) {
          zoomLevel += 25;
          updateZoom();
        }
      });
      
      $("#zoom-out-btn").click(function() {
        if (zoomLevel > 50) {
          zoomLevel -= 25;
          updateZoom();
        }
      });

      // Initialize drag and drop for media items
      initDragAndDrop();

      // Timeline playhead dragging
      initPlayheadDrag();
      
      // Make timeline clips resizable and draggable
      initClipInteractions();

      // Function to generate subtitles using TimeAlignedSubtitles Loop API
      async function generateTimeAlignedSubtitles(audioUrl, languageCode) {
        try {
          showProcessingOverlay();
          
          const response = await fetch('https://magicloops.dev/api/loop/225ddddd-fd4c-4432-bf51-ffd635817f00/run', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              "audioTrackUrl": audioUrl,
              "languageCode": languageCode
            }),
          });
          
          if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
          }
          
          const subtitles = await response.json();
          
          // Process the subtitle data and add it to the timeline
          addSubtitlesToTimeline(subtitles);
          
          hideProcessingOverlay();
          return subtitles;
        } catch (error) {
          console.error("Error generating subtitles:", error);
          hideProcessingOverlay();
          alert("Error al generar subtítulos: " + error.message);
          return null;
        }
      }

      // Function to add generated subtitles to the timeline
      function addSubtitlesToTimeline(subtitles) {
        // This would be implemented to create subtitle clips based on the API response
        const subtitleTrack = document.getElementById('subtitle-track-1');
        
        // Clear existing subtitles if needed
        // subtitleTrack.innerHTML = '';
        
        // In a real implementation, we would loop through the subtitles data
        // and create timeline clips for each subtitle segment
        
        // Example of how this might work:
        // subtitles.forEach(subtitle => {
        //   const clip = document.createElement('div');
        //   clip.className = 'timeline-clip subtitle';
        //   clip.style.left = (subtitle.startTime * 50) + 'px';
        //   clip.style.width = ((subtitle.endTime - subtitle.startTime) * 50) + 'px';
        //   
        //   const label = document.createElement('span');
        //   label.className = 'clip-label';
        //   label.textContent = subtitle.text;
        //   clip.appendChild(label);
        //   
        //   // Add handles
        //   const leftHandle = document.createElement('div');
        //   leftHandle.className = 'clip-handle left';
        //   clip.appendChild(leftHandle);
        //   
        //   const rightHandle = document.createElement('div');
        //   rightHandle.className = 'clip-handle right';
        //   clip.appendChild(rightHandle);
        //   
        //   subtitleTrack.appendChild(clip);
        // });
        
        // Initialize drag and resize functionality for the new clips
        initClipInteractions();
      }

      // Add handler for the generate subtitles button
      $("#generate-subtitles-btn").click(function() {
        // Open a dialog to select language and confirm
        // For the prototype, we'll just use a fixed audio URL and language
        const audioUrl = prompt("URL del archivo de audio:", "https://cdn.example.com/project123/track1.mp3");
        if (audioUrl) {
          const languageCode = prompt("Código de idioma (en, es, fr, etc.):", "es");
          if (languageCode) {
            generateTimeAlignedSubtitles(audioUrl, languageCode);
          }
        }
      });
    });

    function initTimelineRuler() {
      const ruler = document.getElementById("timeline-ruler");
      ruler.innerHTML = '';
      
      // Create time markers (every second = 50px at default zoom)
      for (let i = 0; i <= 30; i++) {
        const marker = document.createElement("div");
        marker.className = i % 5 === 0 ? "timeline-marker major" : "timeline-marker";
        marker.style.left = (i * 50) + "px";
        ruler.appendChild(marker);
        
        if (i % 5 === 0) {
          const label = document.createElement("div");
          label.className = "timeline-marker-label";
          label.style.left = (i * 50) + "px";
          
          // Format time as 00:00
          const minutes = Math.floor(i / 60);
          const seconds = i % 60;
          label.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          
          ruler.appendChild(label);
        }
      }
    }

    function updateZoom() {
      // In a real implementation, this would adjust the timeline scale
      // For the prototype, we'll just update the ruler
      initTimelineRuler();
    }
    
    function showProcessingOverlay() {
      $(".processing-overlay").removeClass("hidden");
    }
    
    function hideProcessingOverlay() {
      $(".processing-overlay").addClass("hidden");
    }

    function initDragAndDrop() {
      // Media library item drag start
      $('.media-item').on('dragstart', function(event) {
        const dataType = $(this).data('type');
        const dataId = $(this).data('id');
        event.originalEvent.dataTransfer.setData('text/plain', JSON.stringify({
          type: dataType,
          id: dataId
        }));
        $(this).addClass('dragging');
      });
      
      $('.media-item').on('dragend', function() {
        $(this).removeClass('dragging');
      });
      
      // Timeline drop target
      $('#timeline-container').on('dragover', function(event) {
        event.preventDefault();
        event.originalEvent.dataTransfer.dropEffect = 'copy';
      });
      
      $('#timeline-container').on('drop', function(event) {
        event.preventDefault();
        try {
          const data = JSON.parse(event.originalEvent.dataTransfer.getData('text/plain'));
          
          // In a real implementation, this would create a new clip
          // For the prototype, we'll just show the processing overlay
          showProcessingOverlay();
          setTimeout(hideProcessingOverlay, 1000);
        } catch (e) {
          console.error('Error processing dropped item:', e);
        }
      });
    }

    function initPlayheadDrag() {
      const playhead = document.getElementById('playhead');
      const timeline = document.getElementById('timeline-container');
      
      // Make the playhead draggable
      interact(playhead)
        .draggable({
          axis: 'x',
          modifiers: [
            interact.modifiers.restrict({
              restriction: 'parent'
            })
          ],
          listeners: {
            move: function(event) {
              const x = (parseFloat(playhead.getAttribute('data-x')) || 0) + event.dx;
              playhead.style.left = x + 'px';
              playhead.setAttribute('data-x', x);
            }
          }
        });
      
      // Allow clicking on the timeline to move the playhead
      timeline.addEventListener('click', function(event) {
        if (event.target === timeline || event.target.classList.contains('timeline-track')) {
          const rect = timeline.getBoundingClientRect();
          const x = event.clientX - rect.left;
          playhead.style.left = x + 'px';
          playhead.setAttribute('data-x', x);
        }
      });
    }

    function initClipInteractions() {
      // Make clips draggable
      $('.timeline-clip').draggable({
        axis: 'x',
        containment: 'parent',
        handle: false,
        start: function(event, ui) {
          $(this).addClass('dragging');
        },
        stop: function(event, ui) {
          $(this).removeClass('dragging');
        }
      });
      
      // Make clip handles for resizing
      $('.clip-handle.left').draggable({
        axis: 'x',
        containment: 'parent',
        drag: function(event, ui) {
          const clip = $(this).parent();
          const originalWidth = parseFloat(clip.css('width'));
          const originalLeft = parseFloat(clip.css('left'));
          
          const dx = ui.position.left;
          clip.css('width', (originalWidth - dx) + 'px');
          clip.css('left', (originalLeft + dx) + 'px');
          
          // Reset handle position
          ui.position.left = 0;
        }
      });
      
      $('.clip-handle.right').draggable({
        axis: 'x',
        containment: 'parent',
        drag: function(event, ui) {
          const clip = $(this).parent();
          clip.css('width', (ui.position.left + 8) + 'px');
          
          // Reset handle position
          ui.position.left = 0;
        }
      });
      
      // Clip selection
      $('.timeline-clip').click(function(e) {
        $('.timeline-clip').removeClass('ring-2 ring-gray-300');
        $(this).addClass('ring-2 ring-gray-300');
        e.stopPropagation();
      });
    }
  </script>
</body>
</html>